#!/usr/bin/env node
// Unit tests

'use strict'
var pentago = require('./pentago/build/Release/pentago')
var board_t = require('./board.js').board_t
var high_board_t = pentago.high_board_t
var Values = require('./values.js')
var Pending = require('./pending.js')
var Log = require('log')

function test_moves(cont) {
  // Check move generation.  Test vectors generated by 'pentago/web/generate moves'
  var moves = {"1011624752379795672":["1011624752379795673m","1011624752379861208m","1011624752379992280m","1011624752380385496m","1011624752379795753m","1011624752379802233m","1011624752523122904m","1011624756674762968m","1011906227356506328m","1014158027170191576m","1011625796056848600m","1011634145473272024m","1011652931660224728m","2858382074578409688m"],"2229312834711074147m":["2229312834711066579","2229312834711066363","2229312834360849763","2229312834332538211","2229333691072263523","2229285827956716899","3307924945466307939","3105262962234635619"],"2410287384723724724":["2410287384723724730m","2410287384724904372m","2410287384723724778m","2410287384723724886m","2410287384723725210m","2410287384723726182m","2410287384723729098m","2410287384819276212m","2415353934304516532m","2410287616651958708m","2455886330950850996m","2410343743284582836m","3641458932856134068m"],"5066549596918038":["5066549596918039m","5066549596918041m","5066549596918047m","5066549596983574m","5066549597507862m","5066549596918065m","5066549596918119m","5066549596918281m","5066549598687510m","5066549602226454m","5066549596918767m","5066549596924599m","5066549644693782m","5066549740245270m","5066550026899734m","5066553891885334m","5066562481819926m","5066588251623702m","5348024573628694m","5910974527050006m","5066665561035030m","5066897489269014m","5067593273970966m","12666373968105750m","27866022710481174m","73464968937607446m","5069680628076822m","5075942690394390m","5094728877347094m","210261807618986262m","620652323663122710m","1851823871795532054m"],"695784702278m":["695784704238","695784703494","695784702278","695784702278","695784702278","695784702278","695784702278","695784702278"],"116043743247":["116043743249m","116043874319m","116044136463m","116044922895m","116043743301m","116043743409m","116043743733m","116047282191m","116054360079m","116043744705m","116043747621m","116043756369m","116330397711m","116903706639m","124633677839m","141813547023m","193353154575m","563065997164559m","1688965904007183m","5066665624535055m","811828445199m","2203397849103m","15199764786118671m","45599062270869519m","136796954725122063m","6378106060815m","18902230695951m","56474604601359m","410390632087879695m","1231171664176152591m","3693514760440971279m"],"6561":["6563m","6567m","6579m","137633m","399777m","1186209m","6615m","6723m","7047m","3545505m","10623393m","31857057m","8019m","10935m","95558049m","286661025m","859969953m","8589941153m","25769810337m","77309417889m","562949953427873m","1688849860270497m","5066549580798369m","231928240545m","695784708513m","2087354112417m","15199648742381985m","45598946227132833m","136796838681385377m","6262062324129m","18786186959265m","56358560864673m","410390516044143009m","1231171548132415905m","3693514644397234593m"],"27m":["3","2187","27","27","27","27","27","27"],
               "5240011396720247894m":["5240011396720250046","5240011396720249110","5240011396352722006","5240011396481696854","5239983221734786134","5240008304343794774","2983707983407629398","3456585944281531478"],"3319782709752515159m":["3319782709752511031","3319782709752515615","3319782709387086423","3319782709420116567","3319759826166762071","3319717013932755543","4008833452740201047","2837897549623872087"],"0":["1m","3m","9m","65536m","196608m","589824m","27m","81m","243m","1769472m","5308416m","15925248m","729m","2187m","6561m","47775744m","143327232m","429981696m","4294967296m","12884901888m","38654705664m","281474976710656m","844424930131968m","2533274790395904m","115964116992m","347892350976m","1043677052928m","7599824371187712m","22799473113563136m","68398419340689408m","3131031158784m","9393093476352m","28179280429056m","205195258022068224m","615585774066204672m","1846757322198614016m"],"4650857499503509072":["4650857499503510530m"],"2977807845258379295":[],"4853554035756516105m":["4853554035756509761","4853554035756517569","4853554036313834249","4853554035787973385","4853528987507245833","4853525895130792713","3070128583317799689","5470547184706274057"],"214483932253520763m":["214483932253520035","214483932253526595","214483932253520763","214483932253520763","214483932253520763","214483932253520763","137922738588222331","2477542745007195003"]}
  for (var name in moves) {
    var high = high_board_t(name)
    var board = new board_t(name)
    var same = new board_t(board.quads,board.middle)
    if (board.name != name || same.name != name || high.name() != name)
      throw 'name inconsistency: name '+name+', same '+same.name+', high '+high.name()
    var correct = moves[name]
    var computed = board.moves().map(function (b) { return b.name })
    var high_computed = high.moves().map(function (b) { return b.name() })
    if (correct+'' != computed+'' || correct+'' != high_computed+'')
      throw 'move computation failed: board '+name
        +'\n  correct '+correct.length+' = '+correct
        +'\n  computed '+computed.length+' = '+computed
        +'\n  high computed '+high_computed.length+' = '+high_computed
  }
  cont()
}

function test_done(cont) {
  // Check win testing.  Test vectors generated by 'pentago/web/generate done'
  var done = {"3599295625825626722":1,"4706614627931736233":-1,"2800750759944146110m":0,"3067569452957116051":0,"4686076695755698968m":-1,"0":2,"3455176138216262816":1,"3465003886922835731m":0,"5538920560076335680m":-1,"1564493876535705655m":1,"2864623001501575616m":1,"4915721312399802719":0,"5438451736521550194":0,"2868874237585467318":-1,"3593661990115223505":-1,"2206845117092922089m":2,"244188594m":2,"5463513441749249788":0,"5240293722143534934":-1,"410390593783595011":2,"4693369610226059532":-1,"615585774066204672":2,"2838754993395347559m":1,"2004116360485749876":-1,"3389040007373334375m":-1,"5099274617027833633":-1,"5516118209351010716":0,"68398419340689408m":2,"3693571002959921881":2,"47775744m":2,"3":2,"4898871859185338552":1,"5232699828791233426":0,"5323898997147314514":-1,"4648076302443956741":0,"1200262125340796566":-1,"3687932094289226058m":0,"3419722940059428573m":-1,"3053739602487095877m":0,"4891265683035270920":0,"5241144357739112085":1,"3638365542191859464":2,"5034788427325516227m":0,"5311221911150741914":-1,"4833249440430629392":1,"3218716816241735302":2,"5240272711152123950m":-1,"3616462493856966618":0,"4716747094886727819":1,"3907461234066933715m":2,"7603032727683234m":2,"5304442533049411926m":0,"478002922956790532":-1,"3005642639102068978m":2,"4892932740192151946":0,"5258850059169116008":-1,"3059089035122329738m":2,"3386750347485982824m":1,"3591947619845943885":1,"4900522011443605274":-1,"971146484513188406m":1,"3388451081322574647m":0,"662047931412185088":2,"2055958406107769223":2,"139330113475379929":2,"2178408899810177037m":2,"2872250889127149914m":-1,"4686077494666871049m":-1,"205252660403319618":2,"2289588435192715977m":1,"2846328021321272429m":1,"4715916238222141077m":1,"3067560060194531047":1,"2846355900096850586m":1,"2864903445239712873":1,"5460669340183317367":1,"4776405235193492006":0,"4825659060869022533m":-1,"2795409229536840657":1,"2328117939142132224":-1,"4822301195253662552m":-1,"1331969547228491835m":2,"589824m":2,"4824843927425008714":-1,"2990751626417621906m":0,"5471357043771648583m":-1,"5468823932735926016":-1,"5258008752942760206":0}
  for (var name in done) {
    var high = new high_board_t(name)
    var board = new board_t(name)
    var v = board.done() ? board.immediate_value() : 2
    if (v != done[name])
      throw 'done check failed: board '+name+', correct '+done[name]+', got '+v
    if (board.done() != high.done())
      throw 'done check failed: board '+name+', board_t '+board.done()+', high_board_t '+high.done()
  }
  cont()
}

function test_str(cont) {
  var s = '1846757322198614016m'
  var b = high_board_t(s)
  if (s != b.name() || s != b)
    throw 'string mismatch'
  cont()
}

function test_pending(cont) {
  var left = 5
  var inputs = {0:0,1:0,2:0}
  var outputs = {7:0,8:0,9:0}
  var slow = function (x,cont) { setTimeout(function () { inputs[x]++; cont(7+x) }, 10) }
  slow = Pending(slow)
  var s = JSON.stringify
  var finish = function () {
    if (s(inputs) != s({0:1,1:1,2:1})) throw 'bad inputs '+s(inputs)
    if (s(outputs) != s({7:2,8:2,9:1})) throw 'bad outputs '+s(outputs)
    cont()
  }
  var expect = function (e) { return function (y) {
    outputs[y]++
    if (y!=e) throw 'bad'
    if (!--left)
      finish()
  }}
  for (var i=0;i<3;i++) slow(i,expect(7+i))
  for (var i=0;i<2;i++) slow(i,expect(7+i))
}

function test_values(cont) {
  var games = [{path:['0','1846757322198614016m','1846757322198614016','1848446172058877952m','1848446172058877952','1848446184943779840m','17732936417673216','428123452461809664m','1849009134897201152','2054204392919269376m','2274880774660423680','2411677613341802496m','2411677613341802496','2411677613343571968m','2411677613485129728','2411677613495746560m','2411677613354188800','2434477086467751936m','4951989278167859200','5362379794211995648m','2435040036421173248','2435040036564500480m','2435040036564500480','2435040036564500642m','2435040036578656418','2435040036578656421m','3313241963915903141','3313241963915903627m','2435040036578656907','2435040036578656934m','2435040036564501158','2435040036596351654m','2435040036579050150','2435041080256103078m','3313243007593349798','3313243007593480870m','3313243007548916390','3313243007692243622m','4078854944345227942','4078873730532180646m','3313261793879196326','3313261793879261862m','3313261793782792870','3313261793782794328m','3313261793782807696','3313262141675158672m','3313262141675145304','3328461790417520728m','3666231762470307928','3666231878434424920m','3328461906381637720','3328461983691049048m','3328461983691062416','3328461983691062425m','3328461984137231513','3328461984137232971m','3328461983691063883','3328461983691064126m','3328461983691057798','3328461983691057816m','3328461983691065592','3328490162971494648m','3328490162971493216','3328496425033810784m','3328509962770727776','3328513093801886560m','4080614231572759392','5311785779705168736m','3465309932483265376','3465309932913247072m','3465293268440138592','3465293268535690080m'],
                values:{'0':1,'1043677052928m':1,'115964116992m':1,'1248904484550082560m':-1,'12884901888m':1,'143327232m':1,'154529775099052032m':-1,'15925248m':1,'1769472m':1,'17732923532771328':1,'17732936417673216':0,'17732936417673218m':-1,'17732936417673222m':-1,'17732936417673234m':-1,'17732936417673270m':-1,'17732936417673378m':-1,'17732936417673702m':-1,'17732936417674674m':-1,'17732936417677590m':-1,'17732936417686338m':-1,'17732936417804288m':-1,'17732936418066432m':-1,'17732936418852864m':-1,'17732936421212160m':-1,'17732936428290048m':-1,'17732936449523712m':-1,'17732936513224704m':0,'17732936704327680m':-1,'17732937277636608m':-1,'17732945007607808m':-1,'17733013727084544m':-1,'17733168345907200m':-1,'17733632202375168m':-1,'17735023771779072m':0,'17739198479990784m':-1,'17751722604625920m':-1,'17789294978531328m':-1,'18295886371094528m':-1,'1846757322198614016':0,'1846757322198614016m':0,'1846757322198614018m':-1,'1846757322198614022m':-1,'1846757322198614034m':-1,'1846757322198614070m':-1,'1846757322198614178m':-1,'1846757322198614502m':-1,'1846757322198615474m':-1,'1846757322198618390m':-1,'1846757322198627138m':-1,'1846757322198745088m':-1,'1846757322199007232m':-1,'1846757322199793664m':-1,'1846757322202152960m':-1,'1846757322209230848m':-1,'1846757322230464512m':-1,'1846757322294165504m':-1,'1846757322485268480m':-1,'1846757323058577408m':-1,'1846757330788548608m':-1,'1846757347968417792m':-1,'1846757399508025344m':-1,'1846757554126848000m':-1,'1846758017983315968m':-1,'1846759409552719872m':-1,'1846763584260931584m':-1,'1846776108385566720m':-1,'1846813680759472128m':-1,'1847320272152035328m':0,'1848446172058877952':0,'1848446172058877952m':0,'1848446172058877953m':0,'1848446172058877955m':0,'1848446172058877961m':0,'1848446172058877979m':0,'1848446172058878033m':0,'1848446172058878195m':0,'1848446172058878681m':0,'1848446172058880139m':0,'1848446172058884513m':0,'1848446172058943488m':0,'1848446172059074560m':0,'1848446172059467776m':0,'1848446172060647424m':0,'1848446172064186368m':0,'1848446172074803200m':0,'1848446172106653696m':0,'1848446172202205184m':0,'1848446172488859648m':0,'1848446176353845248m':0,'1848446184943779840':0,'1848446184943779840m':0,'1848446210713583616m':0,'1848446288022994944':0,'1848446288022994944m':0,'1848446519951228928m':0,'1848447215735930880':0,'1848447215735930880m':0,'1848449303090036736m':0,'1848455565152354304m':0,'1848474351339307008m':0,'1848727647035588608m':0,'1849009134897201152':0,'1849009134897201153m':-1,'1849009134897201155m':-1,'1849009134897201161m':-1,'1849009134897201179m':-1,'1849009134897201233m':0,'1849009134897201395m':0,'1849009134897201881m':0,'1849009134897203339m':0,'1849009134897207713m':0,'1849009134897266688m':0,'1849009134897397760m':0,'1849009134897790976m':0,'1849009134898970624m':0,'1849009134902509568m':0,'1849009134913126400m':0,'1849009134944976896m':0,'1849009135040528384m':0,'1849009135327182848m':0,'1849009139192168448m':0,'1849009173551906816m':0,
                        '1849009250861318144m':0,'1849009482789552128m':0,'1849010178574254080m':0,'1849012265928359936m':-1,'1849018527990677504m':0,'1849037314177630208m':0,'1850979446849273856m':0,'1851542409687597056m':0,'1851823871779405824m':-1,'1856045996430065664m':0,'1856608959268388864m':0,'1861956970940989440m':0,'1871245645172441088m':0,'1871808608010764288m':0,'1892356268425740288m':-1,'1916844591399567360m':0,'1917407554237890560m':0,'19421786277937152m':0,'196608m':1,'1983554160879992832m':0,'1m':0,'205195258022068224':0,'205195258022068224m':1,'2053641430080946176m':0,'2054204392919269376':1,'2054204392919269376m':0,'2054204495998484480':1,'2054205423711420416':0,'2187m':1,'2257147838242750464m':-1,'2274880774660423680':0,'2274880774660423682m':-1,'2274880774660423686m':-1,'2274880774660423698m':-1,'2274880774660423734m':-1,'2274880774660423842m':-1,'2274880774660424166m':-1,'2274880774660425138m':-1,'2274880774660428054m':-1,'2274880774660436802m':-1,'2274880774660554752m':-1,'2274880774660816896m':-1,'2274880774661603328m':-1,'2274880774663962624m':-1,'2274880774671040512m':-1,'2274880774692274176m':-1,'2274880774755975168m':-1,'2274880774947078144m':-1,'2274880775520387072m':-1,'2274880783250358272m':-1,'2274880851969835008m':-1,'2274881006588657664m':-1,'2274881470445125632m':-1,'2274882862014529536m':-1,'2274887036722741248m':-1,'2274899560847376384m':-1,'2274937133221281792m':-1,'2275443724613844992m':0,'2276569624520687616m':-1,'22799473113563136m':1,'2320479720887549952m':-1,'2411677613341802496':0,'2411677613341802496m':0,'2411677613341802497m':-1,'2411677613341802499m':-1,'2411677613341802505m':-1,'2411677613341802523m':-1,'2411677613341802577m':-1,'2411677613341802739m':-1,'2411677613341803225m':-1,'2411677613341804683m':-1,'2411677613341809057m':-1,'2411677613341868032m':-1,'2411677613341999104':1,'2411677613341999104m':0,'2411677613342392320m':-1,'2411677613343571968':1,'2411677613343571968m':0,'2411677613347110912m':-1,'2411677613354188800':0,'2411677613354188801m':-1,'2411677613354188803m':-1,'2411677613354188809m':-1,'2411677613354188827m':-1,'2411677613354188881m':-1,'2411677613354189043m':-1,'2411677613354189529m':-1,'2411677613354190987m':-1,'2411677613354195361m':0,'2411677613354254336m':0,'2411677613354385408m':0,'2411677613354778624m':-1,'2411677613357727744m':0,'2411677613368344576':0,'2411677613370114048m':0,'2411677613389578240m':-1,'2411677613401964544m':-1,'2411677613485129728':0,'2411677613485129728m':0,'2411677613485129730m':0,'2411677613485129734m':0,'2411677613485129746m':0,'2411677613485129782m':0,'2411677613485129890m':0,'2411677613485130214m':0,'2411677613485131186m':0,'2411677613485134102m':0,'2411677613485142850m':0,'2411677613485260800m':0,'2411677613485522944m':0,'2411677613486309376m':0,'2411677613488668672m':0,'2411677613495746560':0,'2411677613495746560m':0,'2411677613497516032m':0,'2411677613516980224m':0,'2411677613580681216m':0,'2411677613771784192m':-1,'2411677613784170496m':-1,
                        '2411677614345093120m':0,'2411677617636769792m':-1,'2411677617649156096m':-1,'2411677622075064320m':-1,'2411677651996508160m':-1,'2411677652008894464m':-1,'2411677690794541056m':0,'2411677716421017600':0,'2411677716422787072':1,'2411677716574961664':0,'2411677729305919488m':0,'2411677729318305792m':0,'2411677845413363712m':0,'2411677961234153472m':-1,'2411677961246539776m':0,'2411678309269831680m':0,'2411678644133953536':0,'2411678644135723008':1,'2411678644287897600':0,'2411678657018855424m':0,'2411678657031241728m':0,'2411679700839235584m':0,'2411680744372961280m':-1,'2411680744385347584m':-1,'2411683875547447296m':-1,'2411687006435278848m':0,'2411687006447665152m':0,'2411696399672082432m':0,'2411705792622231552m':-1,'2411705792634617856m':-1,'2411733972045987840m':0,'2411959088318513152m':0,'2411959088330899456m':-1,'2412240563438551040m':0,'2412522038271934464m':-1,'2412522038284320768m':-1,'2413366463345393664m':0,'2434477086455365632m':-1,'2434477086466179072':0,'2434477086467751936':0,'2434477086467751936m':0,'2434477086609309696':0,'2434477189546967040':0,'2434478117259902976':0,'2435040036421173248':0,'2435040036421173249m':-1,'2435040036421173251m':-1,'2435040036421173257m':-1,'2435040036421173275m':-1,'2435040036421173329m':-1,'2435040036421173491m':-1,'2435040036421173977m':-1,'2435040036421175435m':-1,'2435040036421179809m':0,'2435040036421238784m':0,'2435040036421369856':0,'2435040036421369856m':0,'2435040036421370018':1,'2435040036421763072m':-1,'2435040036435525797':0,'2435040036435526310':0,'2435040036437098496m':0,'2435040036468948992m':-1,'2435040036564500480':0,'2435040036564500480m':0,'2435040036564500482m':0,'2435040036564500486m':0,'2435040036564500498m':0,'2435040036564500534m':0,'2435040036564500642':1,'2435040036564500642m':0,'2435040036564500645':0,'2435040036564500966m':0,'2435040036564501158':0,'2435040036564501160m':0,'2435040036564501176m':0,'2435040036564501938m':0,'2435040036564502616m':0,'2435040036564504854m':0,'2435040036564505532m':0,'2435040036564513602m':0,'2435040036564514280m':-1,'2435040036564631552m':0,'2435040036564632230m':0,'2435040036564893696m':0,'2435040036564894374m':0,'2435040036565680128m':0,'2435040036565680806m':0,'2435040036578656256':0,'2435040036578656418':0,'2435040036578656419m':-1,'2435040036578656421m':0,'2435040036578656427m':-1,'2435040036578656445':1,'2435040036578656445m':0,'2435040036578656661':1,'2435040036578656661m':0,'2435040036578656907':0,'2435040036578656908m':-1,'2435040036578656916m':-1,'2435040036578656934m':0,'2435040036578657147m':-1,'2435040036578657636m':-1,'2435040036578658605m':0,'2435040036578658638':1,'2435040036578659094m':-1,'2435040036578661038':1,'2435040036578662979m':0,'2435040036578663468m':-1,'2435040036578721954m':-1,'2435040036578722443m':-1,'2435040036578853026m':0,'2435040036578853515m':-1,'2435040036579050150':0,'2435040036579050151m':0,'2435040036579050159m':0,'2435040036579050879m':-1,'2435040036579052337m':-1,
                        '2435040036579056711m':-1,'2435040036579115686m':0,'2435040036579246242m':-1,'2435040036579246731m':-1,'2435040036579639974m':-1,'2435040036580425890m':0,'2435040036580426379m':0,'2435040036580819622m':0,'2435040036596350976m':0,'2435040036596351654m':0,'2435040036596353358':1,'2435040036596355758':1,'2435040036626432162m':0,'2435040036626432651m':-1,'2435040036626825894m':0,'2435040036660051968m':0,'2435040036660052646m':0,'2435040036708024998':1,'2435040036851154944m':0,'2435040037008638114m':0,'2435040037008638603m':-1,'2435040037009031846m':0,'2435040037424463872m':0,'2435040037424464550m':-1,'2435040040716140544m':-1,'2435040040873623714m':0,'2435040040873624203m':-1,'2435040040874017446m':-1,'2435040045154435072m':0,'2435040045154435750m':-1,'2435040075075878912m':0,'2435040075233362082m':0,'2435040075233362571m':-1,'2435040075233755814m':0,'2435040113873911808m':0,'2435040113873912486m':0,'2435040139643715584':0,'2435040139643715746':1,'2435040139657871525':1,'2435040139657872038':1,'2435040139675566758':0,'2435040152385290240m':0,'2435040152542773410m':0,'2435040152542773899m':-1,'2435040152543167142':1,'2435040152543167142m':0,'2435040268492734464m':0,'2435040268492735142m':0,'2435040384313524224m':-1,'2435040384471007394m':0,'2435040384471007883m':-1,'2435040384471401126m':-1,'2435040732349202432m':0,'2435040732349203110m':-1,'2435041067356651520':0,'2435041067356651682':0,'2435041067370807461':0,'2435041067370807974':1,'2435041067388502694':0,'2435041080098226176m':0,'2435041080116118182':1,'2435041080255709346m':0,'2435041080255709835m':0,'2435041080256103078m':0,'2435041080256104782':1,'2435041080256107182':1,'2435041080256234150':1,'2435041080273404582':0,'2435041080354996902':1,'2435042123918606336m':0,'2435042123918607014m':0,'2435043167452332032m':-1,'2435043167609815202m':-1,'2435043167609815691m':-1,'2435043167610208934m':0,'2435046298626818048m':0,'2435046298626818726m':-1,'2435049429514649600m':0,'2435049429672132770m':0,'2435049429672133259m':-1,'2435049429672526502m':0,'2435050460464677542':1,'2435058822751453184m':0,'2435058822751453862m':0,'2435059866445547608':0,'2435059866542015142':1,'2435060214337911952':1,'2435068215701602304m':0,'2435068215859085474m':0,'2435068215859085963m':-1,'2435068215859479206m':0,'2435096395125358592m':0,'2435096395125359270m':0,'2435884461351305216m':-1,'2435884461508788386m':0,'2435884461508788875m':-1,'2435884461509182118m':-1,'2436728886424764416m':0,'2436728886424765094m':0,'243m':1,'2457276559712256000m':0,'2464031946125082624m':0,'2464594908963405824m':0,'2533274790395904':0,'2533274790395904m':1,'27m':1,'281474976710656m':1,'28179280429056m':1,'3027263387408007168m':-1,'3027263387420393472m':-1,'3050625810487377920m':-1,'3050625810644861090m':0,'3050625810644861579m':-1,'3050625810645254822m':-1,'3077928870331023360m':0,'3131031158784m':0,'3285375941051678720':0,'3285375941053448192':1,'3285375941205622784':0,'3308175414177628160':0,'3313241963772773003':1,
                        '3313241963901747200':0,'3313241963901747362':1,'3313241963901747851':1,'3313241963915903141':0,'3313241963915903143m':0,'3313241963915903159m':0,'3313241963915903171':1,'3313241963915903195m':0,'3313241963915903627m':0,'3313241963915903654':1,'3313241963915904599m':0,'3313241963915907515m':-1,'3313241963915907755':1,'3313241963915916263m':0,'3313241963916034213m':0,'3313241963916296357m':0,'3313241963917082789m':0,'3313241963919442085m':0,'3313241963933598374':0,'3313241964011454629m':0,'3313241964775866533m':0,'3313241972505837733m':0,'3313242041225314469m':0,'3313242066995118731':0,'3313242079880544934':1,'3313242079979307686':1,'3313242195844137125m':0,'3313242659700605093m':0,'3313242994708054667':1,'3313243007548916390':0,'3313243007548916391m':-1,'3313243007548916399m':-1,'3313243007548917119m':-1,'3313243007548918577m':-1,'3313243007548922951m':-1,'3313243007548981926m':-1,'3313243007549506214m':-1,'3313243007593349798':0,'3313243007593349800m':-1,'3313243007593349816m':-1,'3313243007593351256m':-1,'3313243007593354172m':-1,'3313243007593362920m':-1,'3313243007593480870m':0,'3313243007593482574':1,'3313243007593484974':1,'3313243007594529446m':0,'3313243007595250342':0,'3313243007596888742m':0,'3313243007611830950':0,'3313243007688901286m':-1,'3313243007692243622m':0,'3313243007692245326':1,'3313243007692247726':1,'3313243007978898086m':-1,'3313243008453313190m':-1,'3313243008598213286':1,'3313243011843883686m':-1,'3313243016183284390m':-1,'3313243046203622054m':-1,'3313243084902761126m':-1,'3313243123513033382m':-1,'3313243239521583782m':0,'3313243355441267366m':-1,'3313243703378051750m':-1,'3313244051270008997m':0,'3313244167237011544':1,'3313244167333479078':1,'3313244515129375888':1,'3313246138580075174m':-1,'3313248225978220709m':0,'3313249269655667366m':-1,'3313252387802055334':1,'3313252387900818086':1,'3313252400642392742m':-1,'3313252619732650072':1,'3313252619829117606':1,'3313252967625014416':1,'3313260750102855845m':0,'3313261793780302502m':0,'3313261793782792870':0,'3313261793782792872m':0,'3313261793782792888m':0,'3313261793782794328m':0,'3313261793782796976':1,'3313261793782797244m':0,'3313261793782805992m':0,'3313261793782807696':0,'3313261793782807697m':0,'3313261793782807705m':0,'3313261793782807939m':0,'3313261793782808425m':0,'3313261793830583440m':0,'3313261793878344358m':0,'3313261793879196326':0,'3313261793879196327m':-1,'3313261793879196335m':-1,'3313261793879197055m':-1,'3313261793879198513m':-1,'3313261793879202887m':-1,'3313261793879261862m':0,'3313261793879263320':1,'3313261793879263566':1,'3313261793879265966':1,'3313261793879786150m':-1,'3313261794212789392m':0,'3313261794228963416':1,'3313261794309178022m':-1,'3313261794642756262m':0,'3313261794832941734':0,'3313261798077774992m':0,'3313261798174163622m':-1,'3313261802372727462m':0,'3313261832437513360m':0,'3313261832533901990m':-1,'3313261871092204198m':0,'3313261909746924688m':0,'3313261909843313318m':-1,'3313262025711026854m':0,
                        '3313262141675145304':0,'3313262141675145306m':-1,'3313262141675145322m':0,'3313262141675145832':1,'3313262141675149678m':-1,'3313262141675158426m':0,'3313262141675158672m':0,'3313262141770696792m':-1,'3313262141771547302m':-1,'3313262141771627664':1,'3313262142121327760':0,'3313262142535108696m':-1,'3313262150265079896m':0,'3313262218984556632m':-1,'3313262373603379288m':0,'3313262489567494822m':0,'3313264924813966480m':0,'3313264924910355110m':-1,'3313268055845110438m':0,'3313268403737462872m':-1,'3313271186829345446m':-1,'3313289973063236752m':0,'3313289973159625382m':-1,'3313298322476761253m':0,'3313299366154207910m':-1,'3313318152343650982m':0,'3313318500236003416m':-1,'3320842831920104102m':-1,'3320861618153995408m':0,'3320861618250384038m':-1,'3328441612658278565m':0,'3328442656335725222m':-1,'3328444163871737944':1,'3328452616367376472':1,'3328453565555148888':1,'3328453565555157656':1,'3328453565555162265':1,'3328453565555163966':1,'3328453566001332811':1,'3328453604209871096':1,'3328461442525168294m':0,'3328461790417520728m':0,'3328461790417523376':1,'3328461790417534096':0,'3328461790513989720':0,'3328461790863689816':1,'3328461906381637720':0,'3328461906381637722m':0,'3328461906381637738m':0,'3328461906381642094m':0,'3328461906381650842m':0,'3328461906477189208m':0,'3328461907241601112m':0,'3328461914971572312m':0,'3328461983691049048m':0,'3328461983691049577':1,'3328461983691051696':1,'3328461983691055609':1,'3328461983691057798':0,'3328461983691057816m':0,'3328461983691062416':0,'3328461983691062417m':-1,'3328461983691062425m':0,'3328461983691062659m':0,'3328461983691062702':0,'3328461983691063145m':-1,'3328461983691063883':0,'3328461983691063884m':0,'3328461983691064126m':0,'3328461983691064128':0,'3328461983691065592':0,'3328461983738838160m':-1,'3328461983738839627m':0,'3328461983738841336m':0,'3328461983786609286m':0,'3328461983787518040':1,'3328461983787526808':1,'3328461983787531417':1,'3328461983787533118':1,'3328461984121044112m':-1,'3328461984121045579m':0,'3328461984121047288m':0,'3328461984137218136':1,'3328461984137224699':1,'3328461984137226904':1,'3328461984137231513':0,'3328461984137231515m':0,'3328461984137231787':1,'3328461984137231999m':0,'3328461984137232971m':0,'3328461984137233214':0,'3328461984137362585m':0,'3328461984232783001m':0,'3328461984551021190m':0,'3328461984741212747':1,'3328461987986029712m':-1,'3328461987986031179m':0,'3328461987986032888m':0,'3328461992280992390m':0,'3328461992727166105m':0,'3328465114722221200m':-1,'3328465114722222667m':0,'3328465114722224376m':0,'3328468168443955288m':0,'3328468245753375366m':0,'3328468246199549081m':0,'3328487049120203616':1,'3328490162971486872':0,'3328490162971491472m':0,'3328490162971492939m':0,'3328490162971493216':0,'3328490162971494648m':0,'3328490163067044704m':0,'3328490163067963640':1,'3328490163417663736':0,'3328490163831456608m':0,'3328490171561427808m':0,'3328496425033810752':0,'3328496425033810784m':0,'3328496425033812216':0,
                        '3328496425130279776':0,'3328496425479979872':0,'3328496429328778080':0,'3328508987813136472':1,'3328508987813145240':1,'3328508987813149849':1,'3328508987813151550':1,'3328508988259320395':0,'3328509962770727776':0,'3328509962818503520m':0,'3328509963200709472m':0,'3328512118844311800':1,'3328512127434244960':1,'3328513093801886528':1,'3328513093801886560m':0,'3328513093801887992':1,'3328513093898355552':1,'3328513094248055648':1,'3328518264942495832m':0,'3328518342251915910m':0,'3328518342698089625m':0,'3381641426889605798m':-1,'3381660213123497104m':0,'3381660213219885734m':-1,'3396860403031751824m':-1,'3396860403031753291m':0,'3396860403031755000m':0,'3396908382111417184m':0,'341992096703447040':1,'341992109588348928':0,'3450038802597281957m':-1,'3450039846274728614m':-1,'3450058632464171686m':0,'3450058980356524120m':0,'3465258745063016536m':0,'3465258822372436614m':0,'3465258822818610329m':0,'3465283888231564128':1,'3465287001652872032m':0,'3465293268440138592':0,'3465293268504232800':0,'3465293268535690048':0,'3465293268535690080m':0,'3465293268535691512':0,'3465293268967179104':0,'3465309005295862624':0,'3465309932483265376':0,'3465309932531041120m':0,'3465309932580324192':1,'3465309932913247040':1,'3465309932913247072m':0,'3465309932913248504':1,'3465309932977210208':1,'3465309933008798560':0,'347340134145851392':0,'347892350976m':1,'3506052322792833024m':-1,'3642849161617539072m':0,'3666211584696909824m':0,'3666211584696910502m':-1,'3666222601305065560':1,'3666223529018001496':1,'3666231762470307928':0,'3666231762470307929m':0,'3666231762470307937m':0,'3666231762470310115m':0,'3666231762470314489m':0,'3666231762518083672m':0,'3666231762900289624m':0,'3666231766765275224m':0,'3666231801125013592m':0,'3666231878434424920m':0,'3666231878434427568':1,'3666231878434438288':1,'3666231878530893912':1,'3666231878880594008':1,'3666231955743836248':1,'3666231955743845016':1,'3666231955743849625':1,'3666231955743851326':1,'3666231956190020171':1,'3666234893501466712m':0,'3666259941750736984m':0,'3666260135024281848':1,'3666266397086597984':1,'3666283065854673760':1,'3667076187400439896m':0,'3667955251767362400':0,'3667971916144919392':1,'3711247580814901248m':-1,'38654705664m':1,'3m':1,'4078853900411404288':0,'4078853900568887947':1,'4078854944246465190':1,'4078854944345227942':0,'4078854944345227944m':-1,'4078854944345227960m':-1,'4078854944345229400m':-1,'4078854944345232316m':-1,'4078854944345241064m':-1,'4078854944345359014m':-1,'4078854944346407590m':-1,'4078854945205191334m':-1,'4078854952935162534m':-1,'4078855021654639270m':-1,'4078855176273461926m':-1,'4078855640129929894m':-1,'4078856103986397862':1,'4078861206407545510m':-1,'4078864556482036390':1,'4078873730435187366':1,'4078873730435778648':1,'4078873730532180646m':0,'4078873730532182350':1,'4078873730532184750':1,'4078873730532246182':1,'4078873731438150310':1,'4078874078328142992':1,'4078911302906086054m':-1,'4080543794205491878m':-1,'4080562928188393560':1,
                        '4080563121461921880':1,'4080563121461930648':1,'4080563121461935257':1,'4080563121461936958':1,'4080563121908105803':1,'4080591300742367480':0,'4080597562804683616':1,'4080614231572759392':0,'4080614231668310880m':0,'4080614232432722784m':0,'428123452461809664':1,'428123452461809664m':0,'428123555541024768':1,'428124483253960704':1,'4294967296m':1,'429981696m':1,'47775744m':1,'4924967680391249920':1,'4929189805041909760':0,'4929189805043679232':0,'4929189805195853824':0,'4951989278167859200':0,'4951989278167859202m':-1,'4951989278167859206m':-1,'4951989278167859218m':-1,'4951989278167859254m':-1,'4951989278167859362m':-1,'4951989278167859686m':-1,'4951989278167860658m':-1,'4951989278167863574m':-1,'4951989278167872322m':-1,'4951989278167990272m':-1,'4951989278168252416m':-1,'4951989278169038848m':-1,'4951989278199709696m':-1,'4951989278263410688m':-1,'4951989278454513664m':-1,'4951989279027822592m':-1,'4951989286757793792m':-1,'4951989355477270528m':-1,'4951989510096093184m':-1,'4951989973952561152m':-1,'4951991365521965056m':-1,'4951995540230176768m':-1,'4952008064354811904m':-1,'4952045636728717312m':-1,'4967188926910234624m':-1,'5088786116849238016m':-1,'5308416m':1,'5310026492477637286m':-1,'5311759735023485792':1,'5311769115232060256':1,'5311769115757593440':0,'5311785779705168704':1,'5311785779705168736m':0,'5311785779705170168':1,'5311785779801637728':1,'5311785780135150432':0,'5311785780151337824':0,'5362379794210422784':0,'5362379794211995648':0,'5362379794211995648m':0,'5362379794353553408':0,'5362379794355322880':0,'5362379794355323042':1,'5362379794369478821':0,'5362379794369479334':1,'5362379794387174054':1,'5362379897291210752':0,'5362380825004146688':0,'5362380838046925478':0,'5362399624332772006':1,'5499196926774216792':1,'5514447762936841056':1,'589824m':0,'615585774066204672m':1,'63331882644799488m':-1,'65536m':1,'6561m':1,'68398419340689408m':1,'729m':1,'7599824371187712m':1,'81m':1,'844424930131968m':1,'9393093476352m':1,'9m':1}},
               {path:['0','429981696m','47775744','48168960m','48168960','48169203m','48169203','2087402275059m','2087402275059','2535362192670963m','283562378985715','283562389602547m','283562389602307','23083035503165443m','23099734336012291','23099734367862787m','228013517413220355','228013517413222542m','23099734367864974','23099734367865028m','23099734367863060','23944159297995028m','23944159297996996','23944185067800772m','23944185067798804','23944185067805365m','23927692393388725','23927692393390183m','23927692747284583','23927692890611815m','23927692395159655','23927692395164029m','23927692395154821','23928040287505797m','23928040287515005','434318556331651453m','434318556827103613','434318556827103614m','434318556331651454','434318556332831102m','434318556332821902','441918380704009614m','441918380704018814','4135433025101246846m','505531725440627070','505531725870608766m','4135433025531228542','4135439287593546110m','4549770453311631742','4618168872652321150m','4618179111854354814','4618179112141009278m','4618179112141000078','4618179112141000159m','4618179111951207903','4618179111951221025m','4618179111951217121','4618182242982375905m'],
                values:{'0':1,'1043677052928m':1,'1043725221888m':1,'1049904330399026574m':1,'1049904330893308285m':1,'1121117499506831742m':1,'1127987319734275m':1,'11480495751411m':1,'115964116992m':1,'116012285952m':0,'1231171548180185088m':-1,'1231171548180578547m':-1,'1231455110511395059m':-1,'1254271282468421635m':-1,'1254271282500274318m':-1,'1255099240525798069m':-1,'1255099240527568999m':-1,'1255099588419924349m':-1,'1255115707430406340m':-1,'12884901888m':1,'12933070848m':1,'136796838729154560m':-1,'136796838729548019m':-1,'137080401060364531m':-1,'143327232m':1,'15199648790151168m':-1,'15199648790544627m':-1,'15483211121361139m':-1,'15925248m':1,'159896573017391107m':-1,'159896573049243790m':-1,'160724531074767541m':-1,'160724531076538471m':-1,'160724878968893821m':-1,'160740997979375812m':-1,'1665490104464060798m':-1,'1673089928836428158m':-1,'1688849908039680m':-1,'1688849908433139m':-1,'1769472m':1,'1846757322198614016m':0,'1846757322246782976m':0,'1846759409600889075':0,'1846759409600889075m':0,'1847040884588216323m':0,'1869575581589768334':1,'1869857056566477076m':-1,'1870685014593768837m':-1,'1870685014945898599m':-1,'1870701507266412820m':-1,'18786234728448m':-1,'18786235121907':1,'18786235121907m':-1,'191496192m':1,'196608m':1,'1972412239249651m':-1,'1m':0,'205195258022068224m':1,'205195258070237184m':1,'205197345424343283m':1,'205197345434960115':1,'205478820411670531m':0,'2074770839611834371m':1,'2087386022131':1,'2087401881600m':-1,'2087402274819':1,'2087402275059':1,'2087402275059m':-1,'2087402275060m':0,'2087402275062m':1,'2087402275068m':1,'2087402275086m':1,'2087402275140m':1,'2087402275788m':1,'2087402277003':1,'2087402277246m':1,'2087402281620m':1,'2087402340595m':0,'2087402864883m':0,'2087404044531m':1,'2087407583475m':1,'2087418200307m':0,'2087545602291m':1,'2087787626739':1,'2087832256755m':0,'2091697242355m':1,'2100287176947m':1,'2126056980723m':0,'2187m':1,'2203366392051m':1,'22799473113563136m':1,'22799473161732096m':0,'227994963154503822':1,'227996818548523011':0,'227996818580375694':1,'228013517413220355':1,'228013517413220356m':1,'228013517413220364m':1,'228013517413220382m':1,'228013517413220436m':1,'228013517413220598m':1,'228013517413220622':1,'228013517413221084m':-1,'228013517413222542m':1,'228013517413222596':1,'228013517413226916m':1,'228013517413285891m':-1,'228013517413810179m':-1,'228013517414989827m':1,'228013517556547587m':1,'228013517651773582':1,'228013517767116942':1,'228013517843202051m':-1,'228013521708187651m':-1,'228013530298122243m':1,'228013556067926019m':-1,'228013633377337347m':1,'228013865305571331m':-1,'228014561090273283m':1,'22801560515838195m':0,'228016648444379139m':-1,'228041696693649411m':-1,'2281075878531435918m':1,'2281075879025717629m':1,'228294992389931011m':1,'228294992389931284m':0,'228857942343352323m':1,'229122950417223045m':1,'229122950769352807m':-1,'229139443089867028m':-1,'230546792203616259m':-1,'23080973918863363':0,'23081180109144067':1,'23081180109146308':1,
                        '23083035486912515':0,'23083035503165443m':1,'23083035503165467':-1,'23083035503165683':-1,'23083035535015939':1,'23083035535018180':1,'23083035888517123':0,'23099734336012291':-1,'23099734336012293m':-1,'23099734336012309m':-1,'23099734336012345m':-1,'23099734336012453m':-1,'23099734336012777m':-1,'23099734336013749m':-1,'23099734336016665m':-1,'23099734336025413m':-1,'23099734336143363m':-1,'23099734337191939m':-1,'23099734339551235m':-1,'23099734367862787m':-1,'23099734367862811':1,'23099734367863027':1,'23099734367863060':1,'23099734367863061m':0,'23099734367863069m':0,'23099734367863141m':1,'23099734367863789m':1,'23099734367864974':-1,'23099734367864976m':-1,'23099734367864992m':-1,'23099734367865028m':-1,'23099734367865136m':-1,'23099734367865247m':1,'23099734367865460m':-1,'23099734367866432m':-1,'23099734367867428':1,'23099734367869621m':0,'23099734367878096m':-1,'23099734367928596m':1,'23099734367996046m':-1,'23099734368452884m':-1,'23099734369044622m':-1,'23099734369632532m':1,'23099734371403918m':-1,'23099734511190292m':1,'23099734606413827':1,'23099734606416068':1,'23099734622666755m':-1,'23099734654519438m':-1,'23099734721757187':1,'23099734721759428':1,'23099734797844756m':0,'23099735195975683m':-1,'23099735227828366m':-1,'23099738662830356m':-1,'23099742925946883m':-1,'23099742957799566m':-1,'23099747252764948m':1,'23099760105816067m':-1,'23099760137668750m':-1,'23099773022568724m':-1,'23099811645423619m':-1,'23099811677276302m':-1,'23099850331980052m':-1,'23099966264246275m':-1,'23099966296098958m':-1,'23100082260214036m':1,'23100430120714243m':-1,'23100430152566926m':-1,'23100778044915988m':1,'23101821690118147m':-1,'23101821721970830m':-1,'23102865399021844m':-1,'23105996398329859m':-1,'23105996430182542m':-1,'23127913648292116m':-1,'23156092896870403m':-1,'23156092928723086m':-1,'231976009728m':-1,'231976403187m':-1,'2352289047639241086m':1,'235596874879803495':1,'235596874881577341':1,'235596875377025127':1,'235597222773919109':1,'235613341784408067m':1,'235613341784408340':1,'235613367554214084':1,'235613367554218677':1,'23925605039276308':1,'23927460465148180':0,'23927692393384132':1,'23927692393385295':1,'23927692393388725':-1,'23927692393388727m':-1,'23927692393388743m':-1,'23927692393388887m':-1,'23927692393390183m':-1,'23927692393393099m':-1,'23927692393397263':1,'23927692393519797m':-1,'23927692394568373m':-1,'23927692395154821':1,'23927692395154830m':1,'23927692395154902m':1,'23927692395159655':-1,'23927692395159657m':-1,'23927692395159673m':-1,'23927692395159817m':-1,'23927692395161382m':1,'23927692395164029m':-1,'23927692395167221':1,'23927692395220357m':1,'23927692395290727m':-1,'23927692395744645m':0,'23927692396339303m':-1,'23927692396927669m':-1,'23927692538482053m':1,'23927692620079207':-1,'23927692631941223':1,'23927692632142205':1,'23927692680043189m':-1,'23927692681814119m':-1,'23927692747284583':1,'23927692747284584m':1,'23927692747284592m':-1,'23927692747284664m':1,
                        '23927692747286770m':1,'23927692747350119m':-1,'23927692747874407m':-1,'23927692763209831m':1,'23927692795060327m':-1,'23927692825136517m':1,'23927692890606927':1,'23927692890611815m':1,'23927692890616189':1,'23927692890618895':1,'23927693253352117m':-1,'23927693255123047m':-1,'23927696690122117m':-1,'23927697042251879m':-1,'23927700983323317m':-1,'23927700985094247m':-1,'23927705280056709m':-1,'23927705632186471m':-1,'23927718163192501m':-1,'23927718164963431m':-1,'23927731049860485m':1,'23927731401990247m':-1,'23927769702800053m':-1,'23927769704570983m':-1,'23928040287505797m':1,'23928040287507005':1,'23928040287515005':-1,'23928040287515007m':-1,'23928040287515023m':-1,'23928040287515167m':-1,'23928040287646077m':-1,'23928040288694653m':-1,'23928040524483973':1,'23928040574169469m':-1,'23928040639635559m':-1,'23928040782957957':1,'23928041147478397m':-1,'23928048877449597m':-1,'23928066057318781m':-1,'23928117596926333m':-1,'23928388178090677m':-1,'23928388179861607m':-1,'23930823426313605m':1,'23930823778443367m':-1,'23933954455706293m':-1,'23933954457477223m':-1,'23934302349832573m':-1,'23937085488631173m':1,'23937085840760935m':1,'23944159297995028m':1,'23944159297996996':-1,'23944159297996998m':-1,'23944159297997014m':-1,'23944159297997158m':-1,'23944159297997428':1,'23944159297997482m':-1,'23944159297998454m':-1,'23944159298010118m':-1,'23944159298128068m':-1,'23944159299176644m':-1,'23944159301535940m':-1,'23944159536546068':1,'23944159584651460m':-1,'23944159651889428':1,'23944160157960388m':-1,'23944167887931588m':-1,'23944185067798804':1,'23944185067798805m':-1,'23944185067798813m':-1,'23944185067798885m':1,'23944185067799533m':-1,'23944185067800772m':-1,'23944185067800781':1,'23944185067800991m':1,'23944185067801933':1,'23944185067803172':1,'23944185067805365m':1,'23944185067806823':1,'23944185067864340m':-1,'23944185068388628m':-1,'23944185069568276m':1,'23944185069580669':1,'23944185211126036m':1,'23944185306351812':1,'23944185306356405':1,'23944185421695172':1,'23944185421699765':1,'23944185497780500m':-1,'23944185565028455':1,'23944189362766100m':-1,'23944223722504468m':-1,'23944236607408324m':-1,'23944301031915796m':1,'23944391226230980m':-1,'23944532960149780m':-1,'23944532961922437':1,'23944855082698948m':-1,'23945228744851732m':1,'23946246652102852m':-1,'23946478580341429m':-1,'23946478582112359m':-1,'23946826474467709m':-1,'23947316098957588m':-1,'23950421360314564m':-1,'23955871675583877m':1,'23955872027713639m':-1,'23972364348227860m':-1,'23984050954246837m':-1,'23984050956017767m':-1,'23984398848373117m':-1,'24000517858855108m':-1,'2435294626035m':0,'243m':1,'24788584196276227m':-1,'24788584228128910m':-1,'2533274790395904m':1,'2533274838564864m':1,'2533300608368883':0,'25334835316850691':0,'25351534181548035':1,'25351534181550276':1,'2535362176418035':0,'2535362192670723':0,'2535362192670963m':1,'2535362192672907':0,'2535362203287795':1,'2535362578022643':0,'2552061025517811':-1,
                        '2559173155951554942':1,'2560023842944004478':1,'2560034082242904353':1,'2560034082432683487':1,'2560034082432692606':1,'2560037213274059233':1,'25633009158258964m':1,'25817579520m':-1,'25817972979':1,'25817972979m':-1,'26460967185550725m':1,'26460967537680487m':1,'26477459858194708m':1,'27m':1,'281474976710656m':1,'281475024879616m':1,'281500805300467':1,'28166283916804099m':-1,'28166283948656782m':-1,'2816837179998211m':0,'28179280429056m':1,'28179328598016m':0,'283562373349619':1,'283562378985715':-1,'283562378985715m':1,'283562378985717m':-1,'283562378985721m':-1,'283562378985733m':-1,'283562378985769m':-1,'283562378985877m':-1,'283562378987173m':-1,'283562378990089m':-1,'283562378998837m':-1,'283562379116787m':-1,'283562380165363m':-1,'283562382524659m':-1,'283562389602307':1,'283562389602308m':0,'283562389602316m':0,'283562389602334m':1,'283562389602388m':0,'283562389602547m':-1,'283562389602550m':1,'283562389603036m':0,'283562389604491':1,'283562389604494m':1,'283562389608868m':0,'283562389667843m':0,'283562390192131m':-1,'283562391371779m':1,'283562405527555m':1,'283562410836211m':-1,'283562532929539m':1,'283562665640179m':-1,'283562774954227':1,'283562819584003m':0,'283563238949107m':-1,'283566684569603m':0,'283570968920307m':-1,'283575274504195m':1,'283588148789491m':-1,'283601044307971m':0,'283639688397043m':-1,'283678353719299m':1,'283794307219699m':-1,'283910281953283m':0,'284258163687667m':-1,'286693420761091m':0,'289824441303283m':-1,'28994241974180533m':-1,'28994241975951463m':-1,'28994589868306813m':-1,'29010708878788804m':-1,'292955483078659m':1,'296411936753909763m':0,'300261222449395':1,'302348565938419m':-1,'30266682704115m':0,'30699558739050772m':1,'311741670031363m':0,'3131031158784m':0,'3131079327744m':0,'31527516766342533m':1,'31527517118472295m':-1,'31544009438986516m':-1,'31916032':1,'31916275':0,'334430208m':-1,'334823667m':-1,'339920939843827m':-1,'347892350976m':1,'347940519936m':0,'3693514644445003776m':-1,'3693514644445397235m':-1,'3693798206776213747m':-1,'3716614378733240323m':-1,'3716614378765093006m':-1,'3717442336790616757m':-1,'3717442336792387687m':-1,'3717442684684743037m':-1,'3717458803695225028m':-1,'38299383078387715m':-1,'38299383110240398m':-1,'38654705664m':1,'38702874624m':0,'39127341135764149m':-1,'39127341137535079m':-1,'39127689029890429m':-1,'39143808040372420m':-1,'3929111867171156349':1,'3929111867172335998':1,'3929111867666608510':1,'3m':1,'410390516091912192m':-1,'410390516092305651m':-1,'410674078423122163m':-1,'4127833200728879486m':-1,'4135433025101237646':1,'4135433025101246846m':-1,'4135433025101250766':1,'4135433025531228542':-1,'4135433025531228560m':-1,'4135433025531228704m':-1,'4135433025531359614m':-1,'4135433025595650430':1,'4135433025817883006m':-1,'4135433026197008766':1,'4135433034121163134m':-1,'4135433051301032318m':-1,'4135433102840639870m':-1,'4135439287593536910':1,'4135439287593546110m':-1,'4135439287593550030':1,'4135439287658557822':1,
                        '4135439288307102078':1,'4135449517775663486':1,'4135449526795579774':1,'4135451811718181246m':-1,'4135489384092086654m':-1,'4135505876766503294':1,'4140499575112020350m':-1,'4272229864212607358m':-1,'4294967296m':1,'429981696':0,'429981696m':1,'433490250380148739m':-1,'433490250412001422m':-1,'433520640':1,'433520883':0,'4343136256m':0,'434318208437525173m':-1,'434318208439296103m':-1,'434318556331642245':1,'434318556331651453m':-1,'434318556331651454':-1,'434318556331651472m':-1,'434318556331651616m':-1,'434318556331654645':1,'434318556331782526m':-1,'434318556332821902':1,'434318556332821983m':1,'434318556332828463m':1,'434318556332831102m':-1,'434318556332835022':1,'434318556332887438m':1,'434318556476149134m':1,'434318556556571006':1,'434318556568629629':1,'434318556618305918m':-1,'434318556762803598m':1,'434318556827094414':1,'434318556827103613':1,'434318556827103614m':1,'434318556827103622m':1,'434318556827103694m':1,'434318556827107534':1,'434318556827169149m':1,'434318556827234686':1,'434318556827693437m':1,'434318556843028861m':1,'434318556874879357m':1,'434318557191614846m':-1,'434318557428593022':1,'434318560627789198m':1,'434318561122070909m':1,'434318564921586046m':-1,'434318569217723790m':1,'434318569712005501m':1,'434318582101455230m':-1,'434318594987527566m':1,'434318595481809277m':1,'434318633641062782m':-1,'434321687363980686m':1,'434321687858262397m':1,'434324818393969022m':-1,'434327949426298254m':1,'434327949920579965m':1,'434334675342133444m':-1,'434335049006068093':1,'434335049007247742':1,'434335049501520254':1,'434337342518604158m':-1,'434346735613250958m':1,'434346736107532669m':1,'434374914892509566m':-1,'436851831123217806m':1,'436851831617499517m':1,'439385105912443262m':-1,'441918380704009614m':1,'441918380704017374':1,'441918380704018814':-1,'441918380704018832m':-1,'441918380704018976m':-1,'441918380704149886m':-1,'441918380990673278m':-1,'441918381198291325m':1,'441918381198413198':1,'441918381563982206m':-1,'441918381799771534':1,'441918389293953406m':-1,'441918406473822590m':-1,'441918458013430142m':-1,'441924642766336382m':-1,'441934873378426254':1,'441937166890971518m':-1,'441974739264876926m':-1,'446984930284810622m':-1,'449518205074026878m':-1,'4544697641238531470':1,'4549764190819332478':1,'4549770453311631742':1,'4549770453311631751m':-1,'4549770453311631823m':1,'4549770453311697278m':1,'4549770453454958974m':-1,'4549770457606599038m':-1,'4549770466196533630m':-1,'4549770491966337406m':-1,'4549779846405108094m':1,'4549798632592060798m':-1,'4550051928288342398m':1,'4550614878241763710m':-1,'45598946274902016m':-1,'45598946275295475m':-1,'45882508606111987m':-1,'4618162687996281121':1,'4618162688186060255':1,'4618162688186069374':1,'4618162692291244513':1,'4618168872652311950':1,'4618168872652321150m':1,'4618168872652325070':1,'4618168872717332862':1,'4618168872749187361':1,'4618168872938966495':1,'4618168872938975614':1,'4618168873365877118':1,'4618179111744127265':1,
                        '4618179111854354814':-1,'4618179111854354832m':-1,'4618179111854354976m':-1,'4618179111854485886m':-1,'4618179111951207903':-1,'4618179111951217022':1,'4618179111951217121':1,'4618179111951221025m':-1,'4618179111998992865m':1,'4618179112046759391m':-1,'4618179112141000078':1,'4618179112141000159m':1,'4618179112141006639m':-1,'4618179112141007919':1,'4618179112141009278m':-1,'4618179112141009359':1,'4618179112141013198':1,'4618179112141013281':1,'4618179112141065614m':1,'4618179112571440607':1,'4618179112571449726':1,'4618179150605922785m':1,'4618179150795705742m':-1,'4618179189163766142m':-1,'4618179189260619231m':-1,'4618179227915334113m':1,'4618179228105117070m':-1,'4618179343782588798m':-1,'4618179343879441887m':-1,'4618180155628270049m':1,'4618180155818053006m':1,'4618181199208460670m':-1,'4618181199305313759m':-1,'4618182242775282145':1,'4618182242982375905m':1,'4618182242982379809':1,'4618182243172158862m':-1,'4618182243172168161':1,'4618185373916672382m':-1,'4618185374013525471m':-1,'4618197052029612513':1,'4618207291231646177m':1,'4618207291421429134m':-1,'4618235461825278334':-1,'4618235470415212926m':-1,'4618235470512066015m':-1,'4618460586927927777m':1,'4618460587117710734m':1,'4618742061807776126m':-1,'4618742061904629215m':-1,'4619023536881349089m':1,'4619023537071132046m':-1,'4619867961714618750m':-1,'4619867961811471839m':-1,'4751025061659750782':-1,'4751035300958650657':1,'4751035301148429791':1,'4751035301148438910':1,'4751038431989805537':-1,'47775744':-1,'47775744m':1,'47775746m':-1,'47775750m':-1,'47775762m':-1,'47775798m':-1,'47775906m':-1,'47776230m':-1,'47777202m':-1,'47780118m':-1,'47788866m':-1,'478150656m':0,'47906816m':-1,'48168960':1,'48168960m':-1,'48168961m':0,'48168963':-1,'48168963m':1,'48168969m':1,'48168987m':1,'48169041m':0,'48169203':-1,'48169203m':1,'48169205m':-1,'48169209m':-1,'48169221m':-1,'48169257m':-1,'48169365m':-1,'48169689m':1,'48170661m':-1,'48171147':-1,'48171147m':1,'48173577m':-1,'48175521m':1,'48182325m':-1,'48234496m':0,'48300275m':-1,'48758784m':0,'48955392m':-1,'49348851m':-1,'49938432m':0,'502716975673511310m':1,'502716976167793021m':1,'505531725440627070':1,'505531725440627079m':1,'505531725440627151m':1,'505531725440692606m':1,'505531725583954302m':1,'505531725870599566':1,'505531725870608766m':1,'505531725870612686':1,'505531725935620478':1,'505531726584164734':1,'505531729735594366m':1,'505531738325528958m':1,'505531764095332734m':1,'505534856471785854m':1,'505537987932926334':1,'505541118534103422m':1,'505548218545025406':1,'505559904721056126m':1,'5066549628567552m':-1,'5066549628961011m':-1,'513131549811814782m':1,'51314688m':-1,'51708147m':-1,'5218433433843m':0,'5308416m':1,'53477376m':0,'5350111959777523m':-1,'5366604573663637886m':-1,'562950001197056m':-1,'562950001590515m':-1,'56358608633856m':-1,'56358609027315m':-1,'571115395013030270m':-1,'578715219385397630m':-1,'58392576m':-1,'58786035m':-1,'589824':0,'589824m':0,'615585774066204672m':1,
                        '615585774114373632m':1,'615587861468479731m':1,'615869336455806979m':1,'6262110093312m':-1,'6262110486771m':-1,'638685508434067732m':-1,'639513466461359493m':-1,'639513466813489255m':-1,'639529959134003476m':-1,'64094208m':0,'65536m':1,'6561m':1,'68398419340689408m':1,'68398419388858368m':1,'68400506742964467m':1,'68681981730291715m':1,'695832477696m':-1,'695832871155m':-1,'729m':1,'7599824371187712m':1,'7599824419356672m':1,'7601911773462771m':1,'77357187072m':-1,'77357580531m':-1,'7883386760790019m':1,'79626240m':-1,'80019699m':-1,'81m':1,'843599291479425027m':0,'844424930131968m':1,'844424978300928m':1,'846512332407027m':1,'8637710336m':-1,'8638103795m':-1,'907739136m':-1,'908132595m':-1,'91498153708552468m':1,'92326111735844229m':-1,'92326112087973991m':-1,'92342604408488212m':-1,'93733486617632871':1,'93733486619406717':1,'93733487114854503':1,'93733834511748485':1,'93749953522237716':1,'93749979292043460':1,'93749979292048053':1,'9393093476352m':1,'9393141645312m':1,'94296784465179005':1,'94296784466358654':1,'94296784960631166':1,'95141209396481422':1,'9m':1}},
               // Special chunk-crossing positions
               {path:['1168745766875m','12666408583371931m','1126870637090537m','568288618810944m'],
                values:{'1126870637085217':1,'1126870637090537m':-1,'1126870637100521':1,'1126870745093865':1,'1126871289829097':1,'1148517272262377':1,'1154839464122089':1,'1168745759547':-1,'1168745766875':-1,'1168745766875m':1,'1168745777035':-1,'1169046183899':-1,'1169443069915':-1,'12666408583365827':0,'12666408583371931m':0,'12666408583373419':1,'12666409047366811':1,'12666409285393563':1,'12668538887150747':0,'12672868214185115':1,'15668555358171':-1,'212796053123503849':1,'3694359103958752411':1,'410395854709526080':1,'5071888246181440':1,'568288618807568':1,'568288618810944m':-1,'568288618820688':1,'568288888294976':1,'568289633308224':1,'581791995989568':1,'603679149329984':1,'616148758651018395':0,'70932664861333225':1,'9483802451931':-1}}]

  // Truncate
  var truncate = 0
  if (truncate) {
    games = games.slice(0,2)
    for (var i=0;i<games.length;i++)
      games[i].path = games[i].path.slice(2*19)
  }

  var log = new Log('debug')
  var compute = Values.values({cache:'4M',bits:22},log) // Use a small cache to test replacement
  function epoch(which,cont) {
    var gn = which
    function test(path,values) {
      var seen = {}
      var pn = path.length
      function step(board) {
        log.info('board %s launched',board)
        compute(high_board_t(board),function (results) {
          for (var b in results) {
            seen[b] = 1
            if (b in values && results[b] != values[b])
              throw 'mismatch: board '+b+', correct '+values[b]+', got '+results[b]
          }
          log.info('board %s checked',board)
          if (!--pn) {
            if (!truncate)
              for (var b in values)
                if (!seen[b])
                  throw 'missed board '+b
            if (!--gn)
              cont()
          }
        })
      }
      for (var i=0;i<path.length;i++)
        step(path[i])
    }
    for (var i=0;i<which;i++)
      test(games[i].path,games[i].values)
  }
  // Run the whole thing twice to make sure caching works
  epoch (games.length,function () {
    epoch(1,cont) })
}

function test_slow (cont) {
  var board = high_board_t('274440791932540184')
  var correct = {"274440791932537041":0,"274440791932546937":0,"274440791786788121":1,"274440791950890265":0,"274458384118584601":0,"274463641158554905":0,"684268358023255321":0,"1855204261139584281":1,"274440791932540185m":0,"274440791932537275":1,"274440791932546235":0,"274440791786788123":0,"274440791950890267":-1,"274458384118584603":0,"274463641158554907":0,"684268358023255323":0,"1855204261139584283":1,"274440791932540187m":1,"274440791932543593":0,"274440791932546209":0,"274440791786788129":1,"274440791950890273":0,"274458384118584609":0,"274463641158554913":0,"684268358023255329":0,"1855204261139584289":1,"274440791932540193m":0,"274440791932602568":1,"274440791932611744":0,"274440791787377944":1,"274440791998666008":-1,"274458384118650136":0,"274463641158620440":0,"684268358023320856":0,"1855204261139649816":1,"274440791932605720m":1,"274440791932537113":1,"274440791932546289":0,"274440791786788201":1,"274440791950890345":0,"274458384118584681":0,"274463641158554985":0,"684268358023255401":0,"1855204261139584361":1,"274440791932540265m":0,"274440791937845448":1,"274440791937854624":0,"274440791792096536":1,"274440791956198680":0,"274458384123893016":0,"274463641163863320":0,"684268358028563736":0,"1855204261144892696":1,"274440791937848600m":0,"274440791932537761":0,"274440791932546217":0,"274440791786794681":0,"274440791950896825":-1,"274458384118591161":0,"274463641158561465":0,"684268358023261881":0,"1855204261139590841":0,"274440791932546745m":1,"274440792075864264":0,"274440792075873440":0,"274440791788557592":0,"274440791966815512":0,"274458384261911832":0,"274463641301882136":0,"684268358166582552":0,"1855204261282911512":0,"274440792075867416m":0,"274440830587242696":0,"274440830587251872":0,"274440830441493784":0,"274440830605595928":0,"274486563399013656":0,"274463645453522200":0,"684268396677960984":0,"1855204299794289944":0,"274440830587245848m":0,"274722266909247688":0,"274722266909256864":0,"274722266763498776":0,"274722266927600920":0,"274739859095295256":0,"274745116135265560":0,"686801632813651224":0,"2060399519161652504":0,"274722266909250840m":0,"276974066722932936":0,"276974066722942112":0,"276974066577184024":0,"276974066741286168":0,"276991658908980504":0,"276996915948950808":0,"2531025680221869336":0,"1855485736116294936":0,"276974066722936088m":0,"282040616303724744":1,"282040616303733920":0,"282040616157975832":0,"282040616322077976":-1,"282058208489772312":0,"282063465529742616":0,"685112782953387288":0,"2470790035205788952":1,"282040616303727896m":1,"297240265046100168":-1,"297240265046109344":-1,"297240264900351256":-1,"297240265064453400":-1,"297257857232147736":-1,"297263114272118040":0,"707067831136818456":-1,"1878003734253147416":0,"297240265046103320m":1,"274443922963695816":1,"274443922963704992":0,"274443922817946904":1,"274443922982049048":0,"274458388413551896":0,"274491820438983960":0,"684271489054414104":0,"1855207392170743064":1,"274443922963698968m":0,"274450185026013384":-1,"274450185026022560":0,
                 "274450184880264472":-1,"274450185044366616":-1,"274458500082701592":0,"274464684835607832":0,"684277751116731672":0,"1855213654233060632":0,"274450185026016536m":1,"274468971212966088":1,"274468971212975264":0,"274468971067217176":1,"274468971231319320":0,"274461515149743384":0,"274463679813260568":1,"684296537303684376":0,"1855232440420013336":1,"274468971212969240m":0,"890026565998741704":0,"890026565998750880":0,"890026565852992792":0,"890026566017094936":0,"890044158184789272":0,"890049415224759576":0,"691868182394443032":0,"1923602680480273688":0,"890026565998744856m":0,"2121198114131151048":0,"2121198114131160224":0,"2121198113985402136":0,"2121198114149504280":0,"2121215706317198616":0,"2121220963357168920":0,"889463616045323544":0,"1857737535929980184":0,"2121198114131154200m":0,"274440791932540184":1}
  var log = new Log('debug')
  var compute = Values.values({pool:1},log)
  var left = 16 // Ask for the same board many times to check that we don't recompute it
  for (var i=0;i<16;i++)
    compute(board,function (results) {
      for (var name in correct)
        if (correct[name] != results[name])
          throw 'incorrect result for board '+name+': correct '+correct[name]+', got '+results[name]
      for (var name in results)
        if (!(name in correct || name=='search-time'))
          throw 'unexpected result for board '+name+': value '+results[name]+' does not occur in correct'
      if (!--left)
        cont()
    })

  /* Benchmarks:
   *   cayley    28dec2013 - 1873 s
   *     ''          ''    -  735 s - --bits 23)
   *     ''          ''    -  288 s - --bits 24)
   *   rackspace 29dec2013 -  465 s - --bits 24)
   *   cayley     5jan2014 -   19 s - midsolve!
   *   rackspace     ''    -   25 s - cool, not too much slower
   *   cayley     5jan2014 -   12 s - transpose arrays in midsolve
   *   rackspace     ''    -   16 s
   */

  /* Alternate hard positions:
   *   3232499362891447332 - tie, and doesn't seem to get computed by server.  I need logging for compute processes.
   */
}

var green = '\x1b[1;32m'
var clear = '\x1b[00m'

// Register tests
var tests = [test_moves,test_done,test_pending,test_str]
if (process.argv.length > 2) {
  if (process.argv.length > 3)
    throw 'expected 0 or 1 arguments'
  var cmd = process.argv[2]
  if (cmd == 'all')
    tests.push(test_values)
  else if (cmd == 'slow')
    tests = [test_slow]
  else
    throw "unknown command '"+cmd+"'"
}

// Run all tests
var left_count = tests.length
var left_names = {}
for (var i=0;i<tests.length;i++)
  left_names[tests[i].name] = 1
function run (name,test) {
  console.log('  '+name+': start')
  test(function () {
    console.log('  '+name+': '+green+'pass'+clear)
    if (name in left_names)
      delete left_names[name]
    else
      throw 'test '+name+' completed twice'
    if (!--left_count) {
      console.log(green+'  all tests passed'+clear)
      process.exit(0)
    }
  })
}
for (var i=0;i<tests.length;i++)
  run(tests[i].name,tests[i])
