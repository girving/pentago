#!/usr/bin/env python3
"""Figure out what our probabilities should be"""

import beam
import numpy as np
import supertensors as st


def plan():
  sections = st.descendent_sections(18)
  limit = 2**30
  memorized = {0: 1, 1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 1, 7: 1, 8: 1, 9: 0.3023919095768089, 10: 0.06713106773491546, 11: 0.017808530511928336, 12: 0.004642814578110831, 13: 0.0015155520744692097, 14: 0.000492378664769686, 15: 0.00018769277837386028, 16: 7.191682751273114e-05, 17: 3.420731672168119e-05, 18: 1.6517291722518227e-05}

  print('estimates:')
  probs = {}
  for slice in range(18+1):
    before = beam.estimate(slices=[slice], sections=sections)
    prob = min(1.0, limit / before)
    probs[slice] = prob
    after = int(prob * before)
    print(f'  {slice}: p{prob:.3} * {before:,} = {after:,}')
    assert np.allclose(memorized[slice], prob)

  if 0:
    print()
    print(probs)


if __name__ == '__main__':
  plan()
