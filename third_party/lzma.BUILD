package(default_visibility = ["//visibility:public"])

licenses(["unencumbered"])  # liblzma is public domain

cc_library(
    name = "lzma",
    srcs = glob([
        "common/*.h",
        "common/*.c",
        "liblzma/**/*.h",
        "liblzma/**/*.c",
    ], exclude = [
        "liblzma/check/*_small.c",
        "liblzma/**/*_tablegen.c",
    ]),
    hdrs = ["liblzma/api/lzma.h"],
    includes = ["liblzma/api"],
    copts = [
        "-Wno-unused-function",
        "-include", "sysdefs.h",
        "-Iexternal/lzma/common",
        "-Iexternal/lzma/liblzma/common",
        "-Iexternal/lzma/liblzma/lz",
        "-Iexternal/lzma/liblzma/lzma",
        "-Iexternal/lzma/liblzma/check",
        "-Iexternal/lzma/liblzma/rangecoder",
        "-Iexternal/lzma/liblzma/simple",
        "-Iexternal/lzma/liblzma/delta",

        # Taken from config.h.  Hopefully these work on most unix systems, not just Mac.
        "-DASSUME_RAM=128",
        "-DHAVE_CHECK_CRC32=1",
        "-DHAVE_CHECK_CRC64=1",
        "-DHAVE_CHECK_SHA256=1",
        "-DHAVE_CLOCK_GETTIME=1",
        "-DHAVE_DECL_CLOCK_MONOTONIC=1",
        "-DHAVE_DECODERS=1",
        "-DHAVE_DECODER_ARM=1",
        "-DHAVE_DECODER_ARMTHUMB=1",
        "-DHAVE_DECODER_DELTA=1",
        "-DHAVE_DECODER_IA64=1",
        "-DHAVE_DECODER_LZMA1=1",
        "-DHAVE_DECODER_LZMA2=1",
        "-DHAVE_DECODER_POWERPC=1",
        "-DHAVE_DECODER_SPARC=1",
        "-DHAVE_DECODER_X86=1",
        "-DHAVE_DLFCN_H=1",
        "-DHAVE_ENCODERS=1",
        "-DHAVE_ENCODER_ARM=1",
        "-DHAVE_ENCODER_ARMTHUMB=1",
        "-DHAVE_ENCODER_DELTA=1",
        "-DHAVE_ENCODER_IA64=1",
        "-DHAVE_ENCODER_LZMA1=1",
        "-DHAVE_ENCODER_LZMA2=1",
        "-DHAVE_ENCODER_POWERPC=1",
        "-DHAVE_ENCODER_SPARC=1",
        "-DHAVE_ENCODER_X86=1",
        "-DHAVE_FCNTL_H=1",
        "-DHAVE_FUTIMENS=1",
        "-DHAVE_GETOPT_H=1",
        "-DHAVE_GETOPT_LONG=1",
        "-DHAVE_ICONV=1",
        "-DHAVE_IMMINTRIN_H=1",
        "-DHAVE_INTTYPES_H=1",
        "-DHAVE_LIMITS_H=1",
        "-DHAVE_MBRTOWC=1",
        "-DHAVE_MEMORY_H=1",
        "-DHAVE_MF_BT2=1",
        "-DHAVE_MF_BT3=1",
        "-DHAVE_MF_BT4=1",
        "-DHAVE_MF_HC3=1",
        "-DHAVE_MF_HC4=1",
        "-DHAVE_OPTRESET=1",
        "-DHAVE_PTHREAD_PRIO_INHERIT=1",
        "-DHAVE_STDBOOL_H=1",
        "-DHAVE_STDINT_H=1",
        "-DHAVE_STDLIB_H=1",
        "-DHAVE_STRINGS_H=1",
        "-DHAVE_STRING_H=1",
        "-DHAVE_STRUCT_STAT_ST_ATIMESPEC_TV_NSEC=1",
        "-DHAVE_SYS_PARAM_H=1",
        "-DHAVE_SYS_STAT_H=1",
        "-DHAVE_SYS_TIME_H=1",
        "-DHAVE_SYS_TYPES_H=1",
        "-DHAVE_UINTPTR_T=1",
        "-DHAVE_UNISTD_H=1",
        "-DHAVE_WCWIDTH=1",
        "-DHAVE__BOOL=1",
        "-DHAVE__MM_MOVEMASK_EPI8=1",
        "-DMYTHREAD_POSIX=1",
        "-DPACKAGE_VERSION=\"5.2.3\"",
        "-DSTDC_HEADERS=1",
        "-DTUKLIB_CPUCORES_SYSCTL=1",
        "-DTUKLIB_FAST_UNALIGNED_ACCESS=1",
        "-DTUKLIB_PHYSMEM_SYSCONF=1",
        "-D_GNU_SOURCE=1",
        "-DVERSION=\"5.2.3\"",
    ],
)
